Ext.define("com.coremedia.cms.studio.im.zoom.ZoomSliderTip",function(ZoomSliderTip){function ZoomSliderTip$(config){if(arguments.length<=0)config=null;var config_$1=AS3.cast(com.coremedia.cms.studio.im.zoom.ZoomSliderTipBase,{});var defaults_$1=AS3.cast(ZoomSliderTip,{});config=net.jangaroo.ext.Exml.apply(defaults_$1,config);net.jangaroo.ext.Exml.apply(config_$1,config);this.super$eukP(config_$1)}return{extend:"com.coremedia.cms.studio.im.zoom.ZoomSliderTipBase",constructor:ZoomSliderTip$,super$eukP:function(){com.coremedia.cms.studio.im.zoom.ZoomSliderTipBase.prototype.constructor.apply(this,
arguments)},requires:["com.coremedia.cms.studio.im.zoom.ZoomSliderTipBase","net.jangaroo.ext.Exml"]}});Ext.define("com.coremedia.cms.studio.im.zoom.ZoomSlider",function(ZoomSlider){function ZoomSlider$(config){if(arguments.length<=0)config=null;var config_$1=AS3.cast(com.coremedia.cms.studio.im.zoom.ZoomSliderBase,{});var defaults_$1=AS3.cast(ZoomSlider,{});config=net.jangaroo.ext.Exml.apply(defaults_$1,config);AS3.setBindable(config_$1,"height",200);config_$1.vertical=true;AS3.setBindable(config_$1,"minValue",ZoomSlider.MIN_VALUE);AS3.setBindable(config_$1,"maxValue",ZoomSlider.MAX_VALUE);var ui_BindPropertyPlugin_45_5_$1=
AS3.cast(com.coremedia.ui.plugins.BindPropertyPlugin,{});ui_BindPropertyPlugin_45_5_$1.bidirectional=false;ui_BindPropertyPlugin_45_5_$1.bindTo=AS3.getBindable(config,"zoomValueExpression");ui_BindPropertyPlugin_45_5_$1.transformer=function(value){return value*100};var im_ZoomSliderTip_48_5_$1=AS3.cast(com.coremedia.cms.studio.im.zoom.ZoomSliderTip,{});config_$1.plugins=[ui_BindPropertyPlugin_45_5_$1,im_ZoomSliderTip_48_5_$1];net.jangaroo.ext.Exml.apply(config_$1,config);this.super$Wy6Y(config_$1)}
return{extend:"com.coremedia.cms.studio.im.zoom.ZoomSliderBase",alias:"widget.com.coremedia.cms.studio.im.config.zoomSlider",constructor:ZoomSlider$,super$Wy6Y:function(){com.coremedia.cms.studio.im.zoom.ZoomSliderBase.prototype.constructor.apply(this,arguments)},config:{zoomValueExpression:null},statics:{MIN_VALUE:10,MAX_VALUE:100},requires:["com.coremedia.cms.studio.im.zoom.ZoomSliderBase","com.coremedia.ui.plugins.BindPropertyPlugin","net.jangaroo.ext.Exml"],uses:["com.coremedia.cms.studio.im.zoom.ZoomSliderTip"]}});Ext.define("com.coremedia.cms.studio.im.zoom.ZoomSliderBase",function(ZoomSliderBase){function ZoomSliderBase$(config){if(arguments.length<=0)config=null;this.super$nPkJ(config);this.zoomValueExpression$nPkJ=AS3.getBindable(config,"zoomValueExpression");this.on("change",AS3.bind(this,"writeBack"))}function writeBack(thys,value){var transformedValue=value/100;this.zoomValueExpression$nPkJ.setValue(transformedValue)}return{extend:"Ext.slider.Single",zoomValueExpression$nPkJ:null,constructor:ZoomSliderBase$,
super$nPkJ:function(){Ext.slider.Single.prototype.constructor.apply(this,arguments)},writeBack:writeBack,requires:["Ext.slider.Single"]}});Ext.define("com.coremedia.cms.studio.im.zoom.ZoomSliderTipBase",function(ZoomSliderTipBase){function ZoomSliderTipBase$(config){if(arguments.length<=0)config=null;this.super$SP8A(config)}function getText(thumb){return com.coremedia.ui.util.EncodingUtil.encodeForHTML(thumb["value"]+"%")}return{extend:"Ext.slider.Tip",constructor:ZoomSliderTipBase$,super$SP8A:function(){Ext.slider.Tip.prototype.constructor.apply(this,arguments)},getText:getText,requires:["Ext.slider.Tip","com.coremedia.ui.util.EncodingUtil"]}});Ext.define("com.coremedia.cms.studio.im.zoom.ZoomButton",function(ZoomButton){function ZoomButton$(config){if(arguments.length<=0)config=null;var config_$1=AS3.cast(com.coremedia.cms.studio.im.zoom.ZoomButtonBase,{});var defaults_$1=AS3.cast(ZoomButton,{});config=net.jangaroo.ext.Exml.apply(defaults_$1,config);var ui_BindPropertyPlugin_36_5_$1=AS3.cast(com.coremedia.ui.plugins.BindPropertyPlugin,{});ui_BindPropertyPlugin_36_5_$1.bidirectional=false;ui_BindPropertyPlugin_36_5_$1.componentProperty=
"text";ui_BindPropertyPlugin_36_5_$1.bindTo=AS3.getBindable(config,"zoomValueExpression");ui_BindPropertyPlugin_36_5_$1.transformer=function(value){return Math.round(value*100)+"%"};config_$1.plugins=[ui_BindPropertyPlugin_36_5_$1];var menu_42_5_$1=AS3.cast(Ext.menu.Menu,{});AS3.setBindable(menu_42_5_$1,"minWidth",30);var container_44_9_$1=AS3.cast(Ext.container.Container,{});AS3.setBindable(container_44_9_$1,"layout","hbox");AS3.setBindable(container_44_9_$1,"width",45);var container_47_13_$1=AS3.cast(Ext.container.Container,
{});AS3.setBindable(container_47_13_$1,"layout","vbox");AS3.setBindable(container_47_13_$1,"height","100%");var label_50_17_$1=AS3.cast(Ext.form.Label,{});AS3.setBindable(label_50_17_$1,"text",net.jangaroo.ext.Exml.asString(com.coremedia.cms.studio.im.zoom.ZoomSlider.MAX_VALUE+"%"));var box_51_17_$1=AS3.cast(Ext.Component,{});box_51_17_$1.flex=1;var label_52_17_$1=AS3.cast(Ext.form.Label,{});AS3.setBindable(label_52_17_$1,"text",net.jangaroo.ext.Exml.asString(com.coremedia.cms.studio.im.zoom.ZoomSlider.MIN_VALUE+
"%"));container_47_13_$1.items=[label_50_17_$1,box_51_17_$1,label_52_17_$1];var im_ZoomSlider_55_13_$1=AS3.cast(com.coremedia.cms.studio.im.zoom.ZoomSlider,{});im_ZoomSlider_55_13_$1.itemId=net.jangaroo.ext.Exml.asString(ZoomButton.ZOOM_SLIDER_ITEM_ID);AS3.setBindable(im_ZoomSlider_55_13_$1,"zoomValueExpression",AS3.getBindable(config,"zoomValueExpression"));container_44_9_$1.items=[container_47_13_$1,im_ZoomSlider_55_13_$1];menu_42_5_$1.items=[container_44_9_$1];config_$1.menu=menu_42_5_$1;config_$1.template=
new Ext.Template('\x3cdiv id\x3d"{4}" class\x3d"{3}"\x3e','\x3cem class\x3d"{2}"\x3e\x3cdiv style\x3d"margin-right:12px"\x3e\x3cbutton\x3e\x3c/button\x3e\x3c/div\x3e\x3c/em\x3e',"\x3c/div\x3e");net.jangaroo.ext.Exml.apply(config_$1,config);this.super$1M$p(config_$1)}return{extend:"com.coremedia.cms.studio.im.zoom.ZoomButtonBase",constructor:ZoomButton$,super$1M$p:function(){com.coremedia.cms.studio.im.zoom.ZoomButtonBase.prototype.constructor.apply(this,arguments)},config:{zoomValueExpression:null},
statics:{ZOOM_SLIDER_ITEM_ID:"zoomSlider",TEXT_MENU_BUTTON_CSS_CLASS:"text-menu-button"},requires:["Ext.Component","Ext.Template","Ext.container.Container","Ext.form.Label","Ext.menu.Menu","com.coremedia.cms.studio.im.zoom.ZoomButtonBase","com.coremedia.ui.plugins.BindPropertyPlugin","net.jangaroo.ext.Exml"],uses:["com.coremedia.cms.studio.im.zoom.ZoomSlider"]}});Ext.define("com.coremedia.cms.studio.im.zoom.ZoomButtonBase",function(ZoomButtonBase){function ZoomButtonBase$(config){if(arguments.length<=0)config=null;this.super$DRba(config);this.on("menushow",com.coremedia.ui.components.IFrameMgr.getInstance().showShims,com.coremedia.ui.components.IFrameMgr.getInstance());this.on("menuhide",com.coremedia.ui.components.IFrameMgr.getInstance().hideShims,com.coremedia.ui.components.IFrameMgr.getInstance())}return{extend:"Ext.button.Button",constructor:ZoomButtonBase$,
super$DRba:function(){Ext.button.Button.prototype.constructor.apply(this,arguments)},requires:["Ext.button.Button","com.coremedia.ui.components.IFrameMgr"]}});Ext.define("com.coremedia.cms.studio.im.ImageMapPanel",function(ImageMapPanel){function ImageMapPanel$(config){if(arguments.length<=0)config=null;var config_$1=AS3.cast(com.coremedia.cms.studio.im.ImageMapPanelBase,{});var defaults_$1=AS3.cast(ImageMapPanel,{});config=net.jangaroo.ext.Exml.apply(defaults_$1,config);net.jangaroo.ext.Exml.apply(config_$1,config);this.super$X5yM(config_$1)}return{extend:"com.coremedia.cms.studio.im.ImageMapPanelBase",alias:"widget.com.coremedia.cms.studio.im.config.imageMapPanel",
constructor:ImageMapPanel$,super$X5yM:function(){com.coremedia.cms.studio.im.ImageMapPanelBase.prototype.constructor.apply(this,arguments)},requires:["com.coremedia.cms.studio.im.ImageMapPanelBase","net.jangaroo.ext.Exml"]}});Ext.define("com.coremedia.cms.studio.im.ImageMapEditorBase",function(ImageMapEditorBase){var COORDS_SEPARATOR$static=",";var INLINE_OVERLAY_THEMES$static;function INLINE_OVERLAY_THEMES$static_(){INLINE_OVERLAY_THEMES$static=[["dark-on-light",mx.resources.ResourceManager.getInstance().getString("com.coremedia.cms.studio.im.ImageMap","ImageMap_inline_overlay_theme_dark_light")],["light-on-dark",mx.resources.ResourceManager.getInstance().getString("com.coremedia.cms.studio.im.ImageMap","ImageMap_inline_overlay_theme_light_dark")],
["dark",mx.resources.ResourceManager.getInstance().getString("com.coremedia.cms.studio.im.ImageMap","ImageMap_inline_overlay_theme_dark")],["light",mx.resources.ResourceManager.getInstance().getString("com.coremedia.cms.studio.im.ImageMap","ImageMap_inline_overlay_theme_light")]]}function ImageMapEditorBase$(config){if(arguments.length<=0)config=null;this.super$AoGC(config);this.imageDimensionsValueExpression$AoGC=AS3.getBindable(this,"imageBlobValueExpression").extendBy("metadata.imageDimensions");
this.structValueExpression$AoGC=AS3.getBindable(this,"bindTo").extendBy("properties",AS3.getBindable(config,"structPropertyName"));this.areaIdSuffixCounter$AoGC=0;this.canvasPanel$AoGC=AS3.as(this.queryById(com.coremedia.cms.studio.im.ImageMapEditor.IMAGE_MAP_CANVAS_PANEL_ITEMID),Ext.panel.Panel);this.canvasPanelToolbar$AoGC=AS3.as(this.canvasPanel$AoGC.getDockedItems('toolbar[dock\x3d"top"]')[0],Ext.toolbar.Toolbar);this.toggleShape(AS3.as(this.canvasPanelToolbar$AoGC.queryById(com.coremedia.cms.studio.im.ImageMapEditor.DRAW_RECT_BUTTON_ITEM_ID),
Ext.button.Button),true);this.bindToVersionValueExpression$AoGC=AS3.getBindable(this,"bindTo").extendBy("checkedInVersion.versionNumber");this.getActiveAreaPropertiesItemExpression().addChangeListener(AS3.bind(this,"updateLayout"));this.readOnlyValueExpression$AoGC=com.coremedia.cms.editor.sdk.util.PropertyEditorUtil.createReadOnlyValueExpression(AS3.getBindable(this,"bindTo"),AS3.getBindable(config,"forceReadOnlyValueExpression"));this.readOnlyValueExpression$AoGC.addChangeListener(AS3.bind(this,
"onReadOnlyChange$AoGC"))}function onReadOnlyChange(){var readOnly=this.readOnlyValueExpression$AoGC.getValue();this.canvasMgr$AoGC&&this.canvasMgr$AoGC.clearSelection();this.toggleShim(readOnly)}function createShim(){if(!this.canvasPanel$AoGC.getEl())return null;this.canvasShim$AoGC=com.coremedia.ui.util.ShimmableUtil.createShimForElement(this.canvasPanel$AoGC.getEl());this.fireEvent("shimCreated",this.canvasShim$AoGC)}function toggleShim(show){if(!this.canvasShim$AoGC)this.createShim$AoGC();com.coremedia.ui.util.ShimmableUtil.toggleShim(this.canvasShim$AoGC,
show,true)}function revertObserver(){var this$=this;var newVersionNumber=this.bindToVersionValueExpression$AoGC.getValue();AS3.cast(com.coremedia.cap.content.impl.VersionHistoryImpl,AS3.getBindable(this,"bindTo").extendBy("versionHistory").getValue()).invalidate(function(history){var historyLength=history.getItems().length;if(newVersionNumber===historyLength)AS3.cast(com.coremedia.ui.data.RemoteBean,this$.structValueExpression$AoGC.getValue()).invalidate(AS3.bind(this$,"initCanvas"))})}function updateTheme(checkBox){if(checkBox.getValue()&&
!this.getSelectedAreaExpression().extendBy(com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_INLINE_OVERLAY_THEME).getValue())this.getSelectedAreaExpression().extendBy(com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_INLINE_OVERLAY_THEME).setValue(INLINE_OVERLAY_THEMES$static[0][0])}function afterRender(){var this$=this;Ext.panel.Panel.prototype.afterRender.call(this);this.canvasPanel$AoGC=AS3.as(this.queryById(com.coremedia.cms.studio.im.ImageMapEditor.IMAGE_MAP_CANVAS_PANEL_ITEMID),
Ext.panel.Panel);this.targetLinkEditor$AoGC=AS3.as(this.queryById(ImageMapEditorBase.TARGET_LINK_ITEM_ID),com.coremedia.cms.editor.sdk.premular.fields.SingleLinkEditor);this.mon(this.canvasPanel$AoGC,"resize",function(){if(this$.canvasPanel$AoGC.body&&this$.canvasPanel$AoGC.body.getWidth()>0){this$.imageMapCanvasPanelBodyWidth$AoGC=this$.canvasPanel$AoGC.body.getWidth();this$.imageMapCanvasPanelBodyHeight$AoGC=this$.canvasPanel$AoGC.body.getHeight()}this$.fitToWidth()});this.deleteBtn$AoGC=AS3.as(this.canvasPanelToolbar$AoGC.queryById(ImageMapEditorBase.DELETE_BUTTON_ITEMID),
Ext.button.Button);this.openInTabBtn$AoGC=AS3.as(this.canvasPanelToolbar$AoGC.queryById(ImageMapEditorBase.OPEN_BUTTON_ITEMID),Ext.button.Button);this.fitToWidthBtn$AoGC=AS3.as(this.canvasPanelToolbar$AoGC.queryById(ImageMapEditorBase.FIT_TO_WIDTH_BUTTON_ITEMID),Ext.button.Button);this.bgImage$AoGC=AS3.as(this.queryById(ImageMapEditorBase.IMAGE_ITEM_ID),com.coremedia.ui.components.Image);if(this.bgImage$AoGC.rendered)this.initCanvas();else this.mon(this.bgImage$AoGC,"afterrender",AS3.bind(this,"initCanvas"),
null,{single:true});AS3.getBindable(this,"imageBlobValueExpression").extendBy("uri").addChangeListener(AS3.bind(this,"initCanvas"));this.bindToVersionValueExpression$AoGC.addChangeListener(AS3.bind(this,"revertObserver$AoGC"));this.onReadOnlyChange$AoGC()}function initCanvas(){var this$=this;var initCanvasRequestNumber=++this.initCanvasRequestedCounter$AoGC;if(this.canvasMgr$AoGC)this.canvasMgr$AoGC.destroy();var blobData=AS3.getBindable(this,"imageBlobValueExpression").getValue();if(blobData)this.imageDimensionsValueExpression$AoGC.loadValue(function(imageDimensions){if(initCanvasRequestNumber===
this$.initCanvasRequestedCounter$AoGC){this$.imageWidth$AoGC=imageDimensions["width"];this$.imageHeight$AoGC=imageDimensions["height"];if(this$.imageHeight$AoGC>0&&this$.imageWidth$AoGC>0){this$.initCanvasManager$AoGC();this$.initMapAreas$AoGC();var scale=this$.getZoomValueExpression().getValue();if(scale>0){this$.getZoomValueExpression().setValue(scale);this$.canvasMgr$AoGC.setScale(scale)}this$.fitToWidth()}}})}function initCanvasManager(){this.canvasMgr$AoGC=new com.coremedia.cms.studio.im.ImageMapCanvasManager(this.bgImage$AoGC,
this.imageWidth$AoGC,this.imageHeight$AoGC,this.getSelectedShapeTypeValueExpression());this.mon(this.canvasMgr$AoGC,com.coremedia.cms.studio.im.ImageMapCanvasManager.INITIAL_SHAPE_DRAWN,AS3.bind(this,"onInitialShapeDrawn$AoGC"));this.mon(this.canvasMgr$AoGC,com.coremedia.cms.studio.im.ImageMapCanvasManager.SHAPE_REMOVE,AS3.bind(this,"onShapeRemove$AoGC"));this.mon(this.canvasMgr$AoGC,com.coremedia.cms.studio.im.ImageMapCanvasManager.SHAPE_MOVE,AS3.bind(this,"onShapeMove$AoGC"));this.mon(this.canvasMgr$AoGC,
com.coremedia.cms.studio.im.ImageMapCanvasManager.SHAPE_RESIZE,AS3.bind(this,"onShapeResize$AoGC"));this.mon(this.canvasMgr$AoGC,com.coremedia.cms.studio.im.ImageMapCanvasManager.SHAPE_SELECT,AS3.bind(this,"onShapeSelect$AoGC"));this.mon(this.canvasMgr$AoGC,com.coremedia.cms.studio.im.ImageMapCanvasManager.SHAPE_DOUBLE_CLICK,AS3.bind(this,"onShapeDoubleClick$AoGC"));this.registerDropTarget()}function initMapAreas(){var this$=this;var currentIdSuffixes=[];this.structValueExpression$AoGC.loadValue(function(struct){if(struct){struct.removeValueChangeListener(AS3.bind(this$,
"imageMapChangeHandler$AoGC"));struct.addValueChangeListener(AS3.bind(this$,"imageMapChangeHandler$AoGC"))}struct.load(function(){var imageMapAreas=struct.get(com.coremedia.cms.studio.im.ImageMapEditorConstants.IMAGEMAP_STRUCT_NAME);if(imageMapAreas)imageMapAreas.forEach(function(areaStruct){this$.canvasMgr$AoGC.addArea(areaStruct.toObject?areaStruct.toObject():areaStruct);currentIdSuffixes.push(parseInt(areaStruct.get(com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_ID).split(com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_ID_PREFIX)[1]))});
this$.areaIdSuffixCounter$AoGC=currentIdSuffixes.length>0?Math.max.apply(null,currentIdSuffixes)+1:0})});this.canvasMgr$AoGC.clearSelection()}function imageMapChangeHandler(){var readOnly=this.readOnlyValueExpression$AoGC.getValue();if(readOnly)this.initCanvas()}function addRectArea(coords){if(arguments.length<=0)coords=null;var coordsString=coords&&AS3.is(coords,String)?coords:"10,10,80,80";var areaId=com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_ID_PREFIX+this.areaIdSuffixCounter$AoGC++;
var area=ImageMapEditorBase.createAreaObject(areaId,coordsString);var bean=this.getModifiableStruct();if(bean){bean.addAt(com.coremedia.cms.studio.im.ImageMapEditorConstants.IMAGEMAP_STRUCT_NAME,0,area);this.canvasMgr$AoGC.addArea(area)}}function getSelectedAreaExpression(){if(!this.selectedAreaExpression$AoGC){this.selectedAreaExpression$AoGC=com.coremedia.ui.data.ValueExpressionFactory.createFromValue(undefined);this.selectedAreaExpression$AoGC.addChangeListener(AS3.bind(this,"onAreaSelectionChange$AoGC"))}return this.selectedAreaExpression$AoGC}
function getSelectedAreaInlineOverlayValueExpression(){if(!this.selectedAreaInlineOverlayValueExpression$AoGC)this.selectedAreaInlineOverlayValueExpression$AoGC=this.getSelectedAreaExpression().extendBy(com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_DISPLAY_AS_INLINE_OVERLAY);return this.selectedAreaInlineOverlayValueExpression$AoGC}function getSelectedAreaContentExpression(){if(!this.selectedAreaContentExpression$AoGC)this.selectedAreaContentExpression$AoGC=com.coremedia.ui.data.ValueExpressionFactory.createFromValue([]);
return this.selectedAreaContentExpression$AoGC}function onAreaSelectionChange(expr){var selectedAreaStruct=expr.getValue();this.getSelectedAreaContentExpression().removeChangeListener(AS3.bind(this,"onLinkedContentChange$AoGC"));if(selectedAreaStruct&&selectedAreaStruct.get(com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_LINKED_CONTENT)){this.getSelectedAreaContentExpression().setValue([selectedAreaStruct.get(com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_LINKED_CONTENT)]);this.openInTabBtn$AoGC.setDisabled(false);
this.hideTargetLinkError$AoGC()}else{this.getSelectedAreaContentExpression().setValue([]);this.openInTabBtn$AoGC.setDisabled(true);this.showTargetLinkError$AoGC()}this.deleteBtn$AoGC.setDisabled(selectedAreaStruct==null);this.getSelectedAreaContentExpression().addChangeListener(AS3.bind(this,"onLinkedContentChange$AoGC"))}function onLinkedContentChange(expr){var selectedAreaStruct=this.getSelectedAreaExpression().getValue();if(!selectedAreaStruct)return;var values=expr.getValue();var areaId=selectedAreaStruct.get(com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_ID);
if(values&&values.length>0)this.doLinkedContentChanged$AoGC(AS3.as(values[0],com.coremedia.cap.content.Content),areaId);else{selectedAreaStruct.getType().removeProperty(com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_LINKED_CONTENT);this.getSelectedAreaExpression().setValue(selectedAreaStruct);this.canvasMgr$AoGC.setShapeInvalid(areaId);this.openInTabBtn$AoGC.setDisabled(true);this.showTargetLinkError$AoGC()}}function doLinkedContentChanged(content,areaId){var this$=this;if(content){this.getSelectedAreaExpression().extendBy(com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_LINKED_CONTENT).setValue(content);
content.load(function(){if(content&&content.isInProduction()){this$.canvasMgr$AoGC.setShapeValid(areaId);this$.openInTabBtn$AoGC.setDisabled(false);this$.hideTargetLinkError$AoGC()}else this$.showTargetLinkError$AoGC()})}}function hideTargetLinkError(){AS3.setBindable(this.targetLinkEditor$AoGC,"validationState",undefined)}function showTargetLinkError(){AS3.setBindable(this.targetLinkEditor$AoGC,"validationState",com.coremedia.ui.mixins.ValidationState.ERROR)}function openSelectedAreaLink(){var selectedContent=
this.getSelectedAreaContentExpression().getValue();if(selectedContent)(new com.coremedia.cms.editor.sdk.actions.OpenInTabAction(AS3.cast(com.coremedia.cms.editor.sdk.actions.OpenInTabAction,{contentValueExpression:this.getSelectedAreaContentExpression()}))).execute()}function getActiveAreaPropertiesItemExpression(){if(!this.activeFormItemExpression$AoGC)this.activeFormItemExpression$AoGC=com.coremedia.ui.data.ValueExpressionFactory.createFromValue(ImageMapEditorBase.INFO_TEXT_ITEMID);return this.activeFormItemExpression$AoGC}
function removeSelectedArea(){this.canvasMgr$AoGC.removeSelectedShape()}function onInitialShapeDrawn(shape){var args=Array.prototype.slice.call(arguments,1);switch(shape){case com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_SHAPE_RECT:this.addRectArea(args[0])}}function onShapeRemove(areaId){var struct=this.getModifiableStruct();var imageMapList=struct.get(com.coremedia.cms.studio.im.ImageMapEditorConstants.IMAGEMAP_STRUCT_NAME);var removed=imageMapList.every(function(area,index){if(area.get(com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_ID)===
areaId){struct.removeAt(com.coremedia.cms.studio.im.ImageMapEditorConstants.IMAGEMAP_STRUCT_NAME,index);return false}return true});if(!removed&&joo.debug)AS3.trace("[WARN] area ",areaId,"was not found in",struct.toObject());this.getSelectedAreaExpression().setValue(null)}function getSelectedAreaOrDummyValueExpression(){var this$=this;if(!this.selectedAreaOrDummyValueExpression$AoGC)this.selectedAreaOrDummyValueExpression$AoGC=com.coremedia.ui.data.ValueExpressionFactory.createFromFunction(function(){if(this$.getSelectedAreaExpression().getValue())return this$.getSelectedAreaExpression().getValue();
else return this$.getDummyOverlayBean$AoGC()});return this.selectedAreaOrDummyValueExpression$AoGC}function getDummyOverlayBean(){if(!this.dummyConfigBean$AoGC)this.dummyConfigBean$AoGC=com.coremedia.ui.data.beanFactory.createLocalBean({displayAsInlineOverlay:false});return this.dummyConfigBean$AoGC}function onShapeMove(areaId,shapeType,offsetX,offsetY,shape){if(com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_SHAPE_RECT===shapeType){var rect=AS3.as(shape,Kinetic.Rect);var newCoords=[];newCoords[0]=
offsetX;newCoords[1]=offsetY;newCoords[2]=offsetX+rect.getWidth();newCoords[3]=offsetY+rect.getHeight();var newProps={};newProps[com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_COORDS]=newCoords.join(COORDS_SEPARATOR$static);this.saveAreaProperties(areaId,newProps)}}function onShapeResize(areaId,shapeType,shape){if(com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_SHAPE_RECT===shapeType){var rect=AS3.as(shape,Kinetic.Rect);var newCoords=[];newCoords[0]=rect.getX();newCoords[1]=rect.getY();
newCoords[2]=rect.getX()+rect.getWidth();newCoords[3]=rect.getY()+rect.getHeight();var newProps={};newProps[com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_COORDS]=newCoords.join(COORDS_SEPARATOR$static);this.saveAreaProperties(areaId,newProps)}}function onShapeSelect(areaId){var this$=this;if(areaId)this.getAreaList().forEach(function(area){area=AS3.is(area,com.coremedia.ui.data.Bean)?area:com.coremedia.ui.data.beanFactory.createLocalBean(area);if(area.get(com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_ID)===
areaId){this$.getSelectedAreaExpression().setValue(area);this$.getActiveAreaPropertiesItemExpression().setValue(ImageMapEditorBase.AREA_DETAILS_ITEMID)}});else{this.getSelectedAreaExpression().setValue(null);this.getActiveAreaPropertiesItemExpression().setValue(ImageMapEditorBase.INFO_TEXT_ITEMID)}}function onShapeDoubleClick(){this.openSelectedAreaLink()}function getCanvasManager(){return this.canvasMgr$AoGC}function registerDropTarget(){this.canvasDropTarget$AoGC=new com.coremedia.cms.studio.im.ImageMapCanvasDropTarget(this,
AS3.bind(this,"onCanvasDrop$AoGC"),this.areaContentType)}function onDestroy(){this.getActiveAreaPropertiesItemExpression().removeChangeListener(AS3.bind(this,"updateLayout"));if(this.canvasDropTarget$AoGC)this.canvasDropTarget$AoGC.unreg();Ext.panel.Panel.prototype.onDestroy.call(this)}function onCanvasDrop(shape,dragInfo){var this$=this;var areaId=shape.getId();this.getAreaList().forEach(function(area){if(AS3.is(area,com.coremedia.ui.data.Bean)&&area.get(com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_ID)===
areaId){var draggedItems=dragInfo.getContents();var contents=com.coremedia.cap.content.ContentProxyHelper.getContents(draggedItems);if(draggedItems.length===contents.length&&contents.length===1){var content=contents[0];area.set(com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_LINKED_CONTENT,content);this$.canvasMgr$AoGC.setShapeValid(shape.getId());this$.canvasMgr$AoGC.selectShapeById(shape.getId())}}})}function getZoomValueExpression(){if(!this.zoomValueExpression$AoGC){this.zoomValueExpression$AoGC=
com.coremedia.ui.data.ValueExpressionFactory.createFromValue(1);this.zoomValueExpression$AoGC.addChangeListener(AS3.bind(this,"updateZoom"))}return this.zoomValueExpression$AoGC}function toggleShape(btn,pressed){if(pressed)this.getSelectedShapeTypeValueExpression().setValue(btn.getItemId());else this.getSelectedShapeTypeValueExpression().setValue(undefined)}function getSelectedShapeTypeValueExpression(){if(!this.selectedShapeTypeValueExpression$AoGC)this.selectedShapeTypeValueExpression$AoGC=com.coremedia.ui.data.ValueExpressionFactory.createFromValue(undefined);
return this.selectedShapeTypeValueExpression$AoGC}function updateZoom(){var newZoomValue=isNaN(this.getZoomValueExpression().getValue())?1:this.getZoomValueExpression().getValue();newZoomValue=Math.min(1,parseFloat(newZoomValue.toFixed(2)));if(this.canvasMgr$AoGC&&Math.abs(newZoomValue-parseFloat(this.canvasMgr$AoGC.getScale().toFixed(2)))>.01)this.canvasMgr$AoGC.setScale(newZoomValue);if(newZoomValue<1&&Math.abs(newZoomValue-parseFloat(this.getFitToWidthScale$AoGC().toFixed(2)))>.01)this.fitToWidthBtn$AoGC.toggle(false)}
function fitToWidth(){var this$=this;if(this.fitToWidthBtn$AoGC.pressed){var scale=Math.min(1,this.getFitToWidthScale$AoGC());this.canvasMgr$AoGC&&this.canvasMgr$AoGC.setScale(scale);this.getZoomValueExpression().setValue(scale);this.canvasPanel$AoGC.body.dom.style["overflowX"]="hidden";com.coremedia.ui.util.EventUtil.invokeLater(function(){!!this$.canvasPanel$AoGC.body&&!!this$.canvasPanel$AoGC.body.dom&&(this$.canvasPanel$AoGC.body.dom.style["overflowX"]="auto")})}}function getFitToWidthScale(){var canvasWidth=
this.canvasPanel$AoGC.body.getWidth();var canvasHeight=this.canvasPanel$AoGC.body.getHeight();if(!canvasWidth){canvasWidth=this.imageMapCanvasPanelBodyWidth$AoGC;canvasHeight=this.imageMapCanvasPanelBodyHeight$AoGC}canvasWidth=canvasWidth-2;canvasHeight=canvasHeight-2;var scale=parseFloat((canvasWidth/this.imageWidth$AoGC).toFixed(3));var verticalScrollbarVisible=this.imageHeight$AoGC*scale>canvasHeight;while(this.imageWidth$AoGC*scale>canvasWidth-(verticalScrollbarVisible?18:0)){scale=scale-.001;
verticalScrollbarVisible=this.imageHeight$AoGC*scale>canvasHeight}scale=isNaN(scale)?1:scale;return scale}function beforeDestroy(){var struct=this.structValueExpression$AoGC.getValue();if(AS3.is(struct,com.coremedia.cap.struct.Struct))AS3.cast(com.coremedia.cap.struct.Struct,struct).removeValueChangeListener(AS3.bind(this,"imageMapChangeHandler$AoGC"));this.bindToVersionValueExpression$AoGC.removeChangeListener(AS3.bind(this,"revertObserver$AoGC"));AS3.getBindable(this,"imageBlobValueExpression").removeChangeListener(AS3.bind(this,
"initCanvas"));this.getSelectedAreaExpression().removeChangeListener(AS3.bind(this,"onAreaSelectionChange$AoGC"));this.getSelectedAreaContentExpression().removeChangeListener(AS3.bind(this,"onLinkedContentChange$AoGC"));this.getZoomValueExpression().removeChangeListener(AS3.bind(this,"updateZoom"));this.canvasMgr$AoGC&&this.canvasMgr$AoGC.destroy();this.readOnlyValueExpression$AoGC.removeChangeListener(AS3.bind(this,"onReadOnlyChange$AoGC"));this.canvasShim$AoGC&&this.canvasShim$AoGC.destroy();this.imageMapResizable$AoGC&&
this.imageMapResizable$AoGC.destroy();Ext.panel.Panel.prototype.beforeDestroy.call(this)}function getAreaList(){return this.structValueExpression$AoGC.extendBy(com.coremedia.cms.studio.im.ImageMapEditorConstants.IMAGEMAP_STRUCT_NAME).getValue()||[]}function getModifiableStruct(){var value=this.structValueExpression$AoGC.getValue();if(AS3.is(value,com.coremedia.cap.struct.Struct)){var structType=AS3.cast(com.coremedia.cap.struct.Struct,value).getType();if(!structType.getDescriptor(com.coremedia.cms.studio.im.ImageMapEditorConstants.IMAGEMAP_STRUCT_NAME))structType.addStructListProperty(com.coremedia.cms.studio.im.ImageMapEditorConstants.IMAGEMAP_STRUCT_NAME)}return value}
function saveAreaProperties(areaId,properties){this.getAreaList().forEach(function(areaStruct){if(areaStruct.get(com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_ID)===areaId)areaStruct.updateProperties(properties)})}function createAreaObject$static(areaId,coords){var areaProps={};areaProps[com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_ID]=areaId;areaProps[com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_COORDS]=coords;areaProps[com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_ALT]=
"";areaProps[com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_ROTATION]="";areaProps[com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_SHAPE]=com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_SHAPE_RECT;areaProps[com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_TARGET]=com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_TARGET_BLANK;areaProps[com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_DISPLAY_AS_INLINE_OVERLAY]=false;areaProps[com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_INLINE_OVERLAY_THEME]=
INLINE_OVERLAY_THEMES$static[0][0];return areaProps}function getComboStore$static(){return INLINE_OVERLAY_THEMES$static}return{extend:"Ext.panel.Panel",structValueExpression$AoGC:null,bindToVersionValueExpression$AoGC:null,selectedAreaExpression$AoGC:null,selectedAreaInlineOverlayValueExpression$AoGC:null,selectedAreaContentExpression$AoGC:null,selectedAreaOrDummyValueExpression$AoGC:null,activeFormItemExpression$AoGC:null,imageDimensionsValueExpression$AoGC:null,zoomValueExpression$AoGC:null,selectedShapeTypeValueExpression$AoGC:null,
readOnlyValueExpression$AoGC:null,bgImage$AoGC:null,areaIdSuffixCounter$AoGC:0,imageWidth$AoGC:NaN,imageHeight$AoGC:NaN,imageMapCanvasPanelBodyWidth$AoGC:0,imageMapCanvasPanelBodyHeight$AoGC:0,canvasMgr$AoGC:null,deleteBtn$AoGC:null,openInTabBtn$AoGC:null,fitToWidthBtn$AoGC:null,canvasDropTarget$AoGC:null,initCanvasRequestedCounter$AoGC:0,dummyConfigBean$AoGC:null,imageMapResizable$AoGC:null,targetLinkEditor$AoGC:null,canvasPanel$AoGC:null,canvasPanelToolbar$AoGC:null,canvasShim$AoGC:null,constructor:ImageMapEditorBase$,
super$AoGC:function(){Ext.panel.Panel.prototype.constructor.apply(this,arguments)},onReadOnlyChange$AoGC:onReadOnlyChange,createShim$AoGC:createShim,toggleShim:toggleShim,revertObserver$AoGC:revertObserver,updateTheme:updateTheme,afterRender:afterRender,initCanvas:initCanvas,initCanvasManager$AoGC:initCanvasManager,initMapAreas$AoGC:initMapAreas,imageMapChangeHandler$AoGC:imageMapChangeHandler,addRectArea:addRectArea,getSelectedAreaExpression:getSelectedAreaExpression,getSelectedAreaInlineOverlayValueExpression:getSelectedAreaInlineOverlayValueExpression,
getSelectedAreaContentExpression:getSelectedAreaContentExpression,onAreaSelectionChange$AoGC:onAreaSelectionChange,onLinkedContentChange$AoGC:onLinkedContentChange,doLinkedContentChanged$AoGC:doLinkedContentChanged,hideTargetLinkError$AoGC:hideTargetLinkError,showTargetLinkError$AoGC:showTargetLinkError,openSelectedAreaLink:openSelectedAreaLink,getActiveAreaPropertiesItemExpression:getActiveAreaPropertiesItemExpression,removeSelectedArea:removeSelectedArea,onInitialShapeDrawn$AoGC:onInitialShapeDrawn,
onShapeRemove$AoGC:onShapeRemove,getSelectedAreaOrDummyValueExpression:getSelectedAreaOrDummyValueExpression,getDummyOverlayBean$AoGC:getDummyOverlayBean,onShapeMove$AoGC:onShapeMove,onShapeResize$AoGC:onShapeResize,onShapeSelect$AoGC:onShapeSelect,onShapeDoubleClick$AoGC:onShapeDoubleClick,getCanvasManager:getCanvasManager,registerDropTarget:registerDropTarget,onDestroy:onDestroy,onCanvasDrop$AoGC:onCanvasDrop,getZoomValueExpression:getZoomValueExpression,toggleShape:toggleShape,getSelectedShapeTypeValueExpression:getSelectedShapeTypeValueExpression,
updateZoom:updateZoom,fitToWidth:fitToWidth,getFitToWidthScale$AoGC:getFitToWidthScale,beforeDestroy:beforeDestroy,getAreaList:getAreaList,getModifiableStruct:getModifiableStruct,saveAreaProperties:saveAreaProperties,config:{bindTo:null,imageBlobValueExpression:null},statics:{IMAGE_ITEM_ID:"image",INFO_TEXT_ITEMID:"infoText",AREA_DETAILS_ITEMID:"areaDetails",DELETE_BUTTON_ITEMID:"deleteBtn",OPEN_BUTTON_ITEMID:"openInTab",FIT_TO_WIDTH_BUTTON_ITEMID:"fitToWidth",ZOOM_BUTTON_ITEM_ID:"zoomButton",TARGET_LINK_ITEM_ID:"targetLinkEditor",
INLINE_OVERLAY_THEMES:undefined,createAreaObject:createAreaObject$static,getComboStore:getComboStore$static,__initStatics__:function(){INLINE_OVERLAY_THEMES$static_()}},requires:["AS3.trace","Ext.button.Button","Ext.panel.Panel","Ext.toolbar.Toolbar","com.coremedia.cap.content.Content","com.coremedia.cap.content.ContentProxyHelper","com.coremedia.cap.content.impl.VersionHistoryImpl","com.coremedia.cap.struct.Struct","com.coremedia.cms.editor.sdk.actions.OpenInTabAction","com.coremedia.cms.editor.sdk.premular.fields.SingleLinkEditor",
"com.coremedia.cms.editor.sdk.util.PropertyEditorUtil","com.coremedia.cms.studio.im.ImageMap_properties","com.coremedia.ui.components.Image","com.coremedia.ui.data.Bean","com.coremedia.ui.data.RemoteBean","com.coremedia.ui.data.ValueExpressionFactory","com.coremedia.ui.data.beanFactory","com.coremedia.ui.mixins.ValidationState","com.coremedia.ui.util.EventUtil","com.coremedia.ui.util.ShimmableUtil","mx.resources.ResourceManager"],uses:["com.coremedia.cms.studio.im.ImageMapCanvasDropTarget","com.coremedia.cms.studio.im.ImageMapCanvasManager",
"com.coremedia.cms.studio.im.ImageMapEditor","com.coremedia.cms.studio.im.ImageMapEditorConstants"]}});Ext.define("com.coremedia.cms.studio.im.ImageMapEditor",function(ImageMapEditor){function ImageMapEditor$(config){if(arguments.length<=0)config=null;var config_$1=AS3.cast(com.coremedia.cms.studio.im.ImageMapEditorBase,{});var defaults_$1=AS3.cast(ImageMapEditor,{});config=net.jangaroo.ext.Exml.apply(defaults_$1,config);AS3.setBindable(config_$1,"layout","anchor");var local_ImageMapPanel_54_5_$1=AS3.cast(com.coremedia.cms.studio.im.ImageMapPanel,{});local_ImageMapPanel_54_5_$1.itemId=net.jangaroo.ext.Exml.asString(ImageMapEditor.IMAGE_MAP_CANVAS_PANEL_ITEMID);
local_ImageMapPanel_54_5_$1.anchor="100%";AS3.setBindable(local_ImageMapPanel_54_5_$1,"height",420);AS3.setBindable(local_ImageMapPanel_54_5_$1,"scrollable",true);var ui_BEMPlugin_59_9_$1=AS3.cast(com.coremedia.ui.plugins.BEMPlugin,{});AS3.setBindable(ui_BEMPlugin_59_9_$1,"block",ImageMapEditor.IMAGE_MAP_PANEL_BLOCK);var ui_ResizablePlugin_61_9_$1=AS3.cast(com.coremedia.ui.plugins.ResizablePlugin,{});AS3.setBindable(ui_ResizablePlugin_61_9_$1,"fitComponent",true);var ui_StatefulResizer_63_13_$1=AS3.cast(com.coremedia.ui.components.StatefulResizer,
{});ui_StatefulResizer_63_13_$1.minHeight=300;ui_StatefulResizer_63_13_$1.handles="s";ui_StatefulResizer_63_13_$1.pinned=true;ui_StatefulResizer_63_13_$1.dynamic=false;ui_ResizablePlugin_61_9_$1.resizableConfig=ui_StatefulResizer_63_13_$1;var editor_PropertyFieldPlugin_69_9_$1=AS3.cast(com.coremedia.cms.editor.sdk.premular.PropertyFieldPlugin,{});AS3.setBindable(editor_PropertyFieldPlugin_69_9_$1,"propertyName",net.jangaroo.ext.Exml.asString(AS3.getBindable(config,"structPropertyName")+".image-map"));
var editor_ShowIssuesPlugin_70_9_$1=AS3.cast(com.coremedia.cms.editor.sdk.validation.ShowIssuesPlugin,{});editor_ShowIssuesPlugin_70_9_$1.bindTo=AS3.getBindable(config,"bindTo");AS3.setBindable(editor_ShowIssuesPlugin_70_9_$1,"hideMessage",true);AS3.setBindable(editor_ShowIssuesPlugin_70_9_$1,"propertyName",net.jangaroo.ext.Exml.asString(AS3.getBindable(config,"structPropertyName")+".image-map"));local_ImageMapPanel_54_5_$1.plugins=[ui_BEMPlugin_59_9_$1,ui_ResizablePlugin_61_9_$1,editor_PropertyFieldPlugin_69_9_$1,
editor_ShowIssuesPlugin_70_9_$1];var ui_Image_75_9_$1=AS3.cast(com.coremedia.ui.components.Image,{});ui_Image_75_9_$1.itemId=net.jangaroo.ext.Exml.asString(com.coremedia.cms.studio.im.ImageMapEditorBase.IMAGE_ITEM_ID);ui_Image_75_9_$1.hideMode="visibility";AS3.setBindable(ui_Image_75_9_$1,"x",0);AS3.setBindable(ui_Image_75_9_$1,"y",0);AS3.setBindable(ui_Image_75_9_$1,"src",net.jangaroo.ext.Exml.asString(Ext.BLANK_IMAGE_URL));var ui_BindPropertyPlugin_81_13_$1=AS3.cast(com.coremedia.ui.plugins.BindPropertyPlugin,
{});ui_BindPropertyPlugin_81_13_$1.bindTo=AS3.getBindable(config,"imageBlobValueExpression").extendBy("uri");ui_BindPropertyPlugin_81_13_$1.componentProperty="src";ui_Image_75_9_$1.plugins=[ui_BindPropertyPlugin_81_13_$1];local_ImageMapPanel_54_5_$1.items=[ui_Image_75_9_$1];var toolbar_87_9_$1=AS3.cast(Ext.toolbar.Toolbar,{});var ui_IconButton_89_13_$1=AS3.cast(com.coremedia.ui.components.IconButton,{});ui_IconButton_89_13_$1.itemId=net.jangaroo.ext.Exml.asString(com.coremedia.cms.studio.im.ImageMapEditorBase.DELETE_BUTTON_ITEMID);
AS3.setBindable(ui_IconButton_89_13_$1,"iconCls",net.jangaroo.ext.Exml.asString(this.resourceManager.getString("com.coremedia.icons.CoreIcons","remove")));AS3.setBindable(ui_IconButton_89_13_$1,"tooltip",this.resourceManager.getString("com.coremedia.cms.studio.im.ImageMap","ImageMap_deleteArea_text"));AS3.setBindable(ui_IconButton_89_13_$1,"text",net.jangaroo.ext.Exml.asString(this.resourceManager.getString("com.coremedia.cms.studio.im.ImageMap","ImageMap_deleteArea_text")));AS3.setBindable(ui_IconButton_89_13_$1,
"disabled",true);AS3.setBindable(ui_IconButton_89_13_$1,"handler",AS3.bind(this,"removeSelectedArea"));var editor_BindDisablePlugin_96_17_$1=AS3.cast(com.coremedia.cms.editor.sdk.premular.fields.plugins.BindDisablePlugin,{});editor_BindDisablePlugin_96_17_$1.bindTo=AS3.getBindable(config,"bindTo");AS3.setBindable(editor_BindDisablePlugin_96_17_$1,"forceReadOnlyValueExpression",AS3.getBindable(config,"forceReadOnlyValueExpression"));ui_IconButton_89_13_$1.plugins=[editor_BindDisablePlugin_96_17_$1];
var ui_IconButton_100_13_$1=AS3.cast(com.coremedia.ui.components.IconButton,{});ui_IconButton_100_13_$1.itemId=net.jangaroo.ext.Exml.asString(com.coremedia.cms.studio.im.ImageMapEditorBase.OPEN_BUTTON_ITEMID);AS3.setBindable(ui_IconButton_100_13_$1,"iconCls",net.jangaroo.ext.Exml.asString(this.resourceManager.getString("com.coremedia.icons.CoreIcons","pencil")));AS3.setBindable(ui_IconButton_100_13_$1,"tooltip",this.resourceManager.getString("com.coremedia.cms.studio.im.ImageMap","ImageMap_openInTab_text"));
AS3.setBindable(ui_IconButton_100_13_$1,"text",net.jangaroo.ext.Exml.asString(this.resourceManager.getString("com.coremedia.cms.studio.im.ImageMap","ImageMap_openInTab_text")));AS3.setBindable(ui_IconButton_100_13_$1,"disabled",true);AS3.setBindable(ui_IconButton_100_13_$1,"handler",AS3.bind(this,"openSelectedAreaLink"));var tbSeparator_106_13_$1=AS3.cast(Ext.toolbar.Separator,{});var ui_IconButton_107_13_$1=AS3.cast(com.coremedia.ui.components.IconButton,{});ui_IconButton_107_13_$1.itemId=net.jangaroo.ext.Exml.asString(ImageMapEditor.DRAW_RECT_BUTTON_ITEM_ID);
ui_IconButton_107_13_$1.enableToggle=true;ui_IconButton_107_13_$1.toggleGroup=net.jangaroo.ext.Exml.asString(ImageMapEditor.DRAW_SHAPES_BUTTONS_TOGGLE_GROUP);AS3.setBindable(ui_IconButton_107_13_$1,"pressed",true);AS3.setBindable(ui_IconButton_107_13_$1,"iconCls",net.jangaroo.ext.Exml.asString(this.resourceManager.getString("com.coremedia.icons.CoreIcons","add_hotzone")));AS3.setBindable(ui_IconButton_107_13_$1,"tooltip",this.resourceManager.getString("com.coremedia.cms.studio.im.ImageMap","ImageMap_addRect_text"));
AS3.setBindable(ui_IconButton_107_13_$1,"text",net.jangaroo.ext.Exml.asString(this.resourceManager.getString("com.coremedia.cms.studio.im.ImageMap","ImageMap_addRect_text")));ui_IconButton_107_13_$1.toggleHandler=AS3.bind(this,"toggleShape");var editor_BindDisablePlugin_116_17_$1=AS3.cast(com.coremedia.cms.editor.sdk.premular.fields.plugins.BindDisablePlugin,{});editor_BindDisablePlugin_116_17_$1.bindTo=AS3.getBindable(config,"bindTo");AS3.setBindable(editor_BindDisablePlugin_116_17_$1,"forceReadOnlyValueExpression",
AS3.getBindable(config,"forceReadOnlyValueExpression"));ui_IconButton_107_13_$1.plugins=[editor_BindDisablePlugin_116_17_$1];var tbFill_120_13_$1=AS3.cast(Ext.toolbar.Fill,{});var im_ZoomButton_121_13_$1=AS3.cast(com.coremedia.cms.studio.im.zoom.ZoomButton,{});im_ZoomButton_121_13_$1.itemId=net.jangaroo.ext.Exml.asString(com.coremedia.cms.studio.im.ImageMapEditorBase.ZOOM_BUTTON_ITEM_ID);AS3.setBindable(im_ZoomButton_121_13_$1,"zoomValueExpression",this.getZoomValueExpression());var tbSpacer_123_13_$1=
AS3.cast(Ext.toolbar.Spacer,{});AS3.setBindable(tbSpacer_123_13_$1,"width",3);var ui_IconButton_124_13_$1=AS3.cast(com.coremedia.ui.components.IconButton,{});ui_IconButton_124_13_$1.itemId=net.jangaroo.ext.Exml.asString(com.coremedia.cms.studio.im.ImageMapEditorBase.FIT_TO_WIDTH_BUTTON_ITEMID);AS3.setBindable(ui_IconButton_124_13_$1,"pressed",true);ui_IconButton_124_13_$1.enableToggle=true;AS3.setBindable(ui_IconButton_124_13_$1,"iconCls",net.jangaroo.ext.Exml.asString(this.resourceManager.getString("com.coremedia.cms.editor.sdk.actions.Actions",
"Action_fullWidth_icon")));AS3.setBindable(ui_IconButton_124_13_$1,"tooltip",this.resourceManager.getString("com.coremedia.cms.studio.im.ImageMap","ImageMap_fitToWidth_text"));AS3.setBindable(ui_IconButton_124_13_$1,"text",net.jangaroo.ext.Exml.asString(this.resourceManager.getString("com.coremedia.cms.studio.im.ImageMap","ImageMap_fitToWidth_text")));AS3.setBindable(ui_IconButton_124_13_$1,"handler",AS3.bind(this,"fitToWidth"));toolbar_87_9_$1.items=[ui_IconButton_89_13_$1,ui_IconButton_100_13_$1,
tbSeparator_106_13_$1,ui_IconButton_107_13_$1,tbFill_120_13_$1,im_ZoomButton_121_13_$1,tbSpacer_123_13_$1,ui_IconButton_124_13_$1];local_ImageMapPanel_54_5_$1.tbar=toolbar_87_9_$1;var layout_Absolute_136_9_$1=AS3.cast(Ext.layout.container.Absolute,{});AS3.setBindable(local_ImageMapPanel_54_5_$1,"layout",layout_Absolute_136_9_$1);var ui_SwitchingContainer_139_5_$1=AS3.cast(com.coremedia.ui.components.SwitchingContainer,{});AS3.setBindable(ui_SwitchingContainer_139_5_$1,"activeItemValueExpression",
this.getActiveAreaPropertiesItemExpression());var fieldContainer_141_9_$1=AS3.cast(Ext.form.FieldContainer,{});fieldContainer_141_9_$1.itemId=net.jangaroo.ext.Exml.asString(com.coremedia.cms.studio.im.ImageMapEditorBase.AREA_DETAILS_ITEMID);AS3.setBindable(fieldContainer_141_9_$1,"layout","anchor");fieldContainer_141_9_$1.labelSeparator="";fieldContainer_141_9_$1.labelAlign="top";var labelable_146_13_$1=AS3.cast(Ext.form.Labelable,{});labelable_146_13_$1.labelSeparator="";labelable_146_13_$1.labelAlign=
"top";fieldContainer_141_9_$1["defaultType"]=labelable_146_13_$1["xtype"];delete labelable_146_13_$1["xtype"];delete labelable_146_13_$1["xclass"];fieldContainer_141_9_$1.defaults=labelable_146_13_$1;var editor_SingleLinkEditor_150_13_$1=AS3.cast(com.coremedia.cms.editor.sdk.premular.fields.SingleLinkEditor,{});editor_SingleLinkEditor_150_13_$1.itemId=net.jangaroo.ext.Exml.asString(com.coremedia.cms.studio.im.ImageMapEditorBase.TARGET_LINK_ITEM_ID);AS3.setBindable(editor_SingleLinkEditor_150_13_$1,
"linkContentType",net.jangaroo.ext.Exml.asString(AS3.getBindable(config,"areaContentType")));AS3.setBindable(editor_SingleLinkEditor_150_13_$1,"bindTo",this.getSelectedAreaContentExpression());AS3.setBindable(editor_SingleLinkEditor_150_13_$1,"fieldLabel",net.jangaroo.ext.Exml.asString(this.resourceManager.getString("com.coremedia.cms.studio.im.ImageMap","ImageMap_linkedContent_fieldLabel")));var editor_ShowIssuesPlugin_155_17_$1=AS3.cast(com.coremedia.cms.editor.sdk.validation.ShowIssuesPlugin,{});
editor_ShowIssuesPlugin_155_17_$1.bindTo=AS3.getBindable(config,"bindTo");AS3.setBindable(editor_ShowIssuesPlugin_155_17_$1,"hideMessage",false);AS3.setBindable(editor_ShowIssuesPlugin_155_17_$1,"propertyName",net.jangaroo.ext.Exml.asString(AS3.getBindable(config,"structPropertyName")+".image-map"));editor_SingleLinkEditor_150_13_$1.plugins=[editor_ShowIssuesPlugin_155_17_$1];editor_SingleLinkEditor_150_13_$1["plugins$at"]=net.jangaroo.ext.Exml.APPEND;var textField_160_13_$1=AS3.cast(Ext.form.field.Text,
{});textField_160_13_$1.anchor="100%";AS3.setBindable(textField_160_13_$1,"fieldLabel",net.jangaroo.ext.Exml.asString(this.resourceManager.getString("com.coremedia.cms.studio.im.ImageMap","ImageMap_alt_fieldLabel")));var ui_BindPropertyPlugin_163_17_$1=AS3.cast(com.coremedia.ui.plugins.BindPropertyPlugin,{});ui_BindPropertyPlugin_163_17_$1.bindTo=this.getSelectedAreaExpression().extendBy(com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_ALT);ui_BindPropertyPlugin_163_17_$1.bidirectional=true;
ui_BindPropertyPlugin_163_17_$1.ifUndefined="";var ui_BlockEnterPlugin_166_17_$1=AS3.cast(com.coremedia.ui.plugins.BlockEnterPlugin,{});textField_160_13_$1.plugins=[ui_BindPropertyPlugin_163_17_$1,ui_BlockEnterPlugin_166_17_$1];var component_169_13_$1=AS3.cast(Ext.Component,{});AS3.setBindable(component_169_13_$1,"height",5);var checkbox_170_13_$1=AS3.cast(Ext.form.field.Checkbox,{});AS3.setBindable(checkbox_170_13_$1,"fieldLabel",net.jangaroo.ext.Exml.asString(this.resourceManager.getString("com.coremedia.cms.studio.im.ImageMap",
"ImageMap_inline_overlay_fieldLabel")));AS3.setBindable(checkbox_170_13_$1,"boxLabel",net.jangaroo.ext.Exml.asString(this.resourceManager.getString("com.coremedia.cms.studio.im.ImageMap","ImageMap_inline_overlay_boxLabel")));checkbox_170_13_$1.handler=AS3.bind(this,"updateTheme");var ui_BindPropertyPlugin_175_17_$1=AS3.cast(com.coremedia.ui.plugins.BindPropertyPlugin,{});ui_BindPropertyPlugin_175_17_$1.bindTo=this.getSelectedAreaOrDummyValueExpression().extendBy(com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_DISPLAY_AS_INLINE_OVERLAY);
ui_BindPropertyPlugin_175_17_$1.bidirectional=true;ui_BindPropertyPlugin_175_17_$1.ifUndefined="false";checkbox_170_13_$1.plugins=[ui_BindPropertyPlugin_175_17_$1];var ui_LocalComboBox_181_13_$1=AS3.cast(com.coremedia.ui.components.LocalComboBox,{});AS3.setBindable(ui_LocalComboBox_181_13_$1,"store",com.coremedia.cms.studio.im.ImageMapEditorBase.getComboStore());ui_LocalComboBox_181_13_$1.anchor="100%";AS3.setBindable(ui_LocalComboBox_181_13_$1,"encodeItems",true);AS3.setBindable(ui_LocalComboBox_181_13_$1,
"fieldLabel",net.jangaroo.ext.Exml.asString(this.resourceManager.getString("com.coremedia.cms.studio.im.ImageMap","ImageMap_inline_overlay_text_color_fieldLabel")));var ui_BindPropertyPlugin_186_17_$1=AS3.cast(com.coremedia.ui.plugins.BindPropertyPlugin,{});ui_BindPropertyPlugin_186_17_$1.bindTo=this.getSelectedAreaExpression().extendBy(com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_INLINE_OVERLAY_THEME);ui_BindPropertyPlugin_186_17_$1.componentEvent="select";ui_BindPropertyPlugin_186_17_$1.bidirectional=
true;ui_BindPropertyPlugin_186_17_$1.ifUndefined="";var ui_BindVisibilityPlugin_191_17_$1=AS3.cast(com.coremedia.ui.plugins.BindVisibilityPlugin,{});ui_BindVisibilityPlugin_191_17_$1.bindTo=this.getSelectedAreaInlineOverlayValueExpression();ui_LocalComboBox_181_13_$1.plugins=[ui_BindPropertyPlugin_186_17_$1,ui_BindVisibilityPlugin_191_17_$1];ui_LocalComboBox_181_13_$1["plugins$at"]=net.jangaroo.ext.Exml.APPEND;fieldContainer_141_9_$1.items=[editor_SingleLinkEditor_150_13_$1,textField_160_13_$1,component_169_13_$1,
checkbox_170_13_$1,ui_LocalComboBox_181_13_$1];var label_196_9_$1=AS3.cast(Ext.form.Label,{});label_196_9_$1.itemId=net.jangaroo.ext.Exml.asString(com.coremedia.cms.studio.im.ImageMapEditorBase.INFO_TEXT_ITEMID);AS3.setBindable(label_196_9_$1,"text",net.jangaroo.ext.Exml.asString(this.resourceManager.getString("com.coremedia.cms.studio.im.ImageMap","ImageMap_emptySelection_text")));ui_SwitchingContainer_139_5_$1.items=[fieldContainer_141_9_$1,label_196_9_$1];var layout_Card_200_9_$1=AS3.cast(Ext.layout.container.Card,
{});layout_Card_200_9_$1.deferredRender=true;AS3.setBindable(ui_SwitchingContainer_139_5_$1,"layout",layout_Card_200_9_$1);config_$1.items=[local_ImageMapPanel_54_5_$1,ui_SwitchingContainer_139_5_$1];net.jangaroo.ext.Exml.apply(config_$1,config);this.super$QcwR(config_$1)}return{extend:"com.coremedia.cms.studio.im.ImageMapEditorBase",alias:"widget.com.coremedia.cms.studio.im.config.imageMapEditor",constructor:ImageMapEditor$,super$QcwR:function(){com.coremedia.cms.studio.im.ImageMapEditorBase.prototype.constructor.apply(this,
arguments)},config:{forceReadOnlyValueExpression:null,structPropertyName:null,areaContentType:null},statics:{DRAW_SHAPES_BUTTONS_TOGGLE_GROUP:"drawShapesButtonsToggleGroup",DRAW_RECT_BUTTON_ITEM_ID:"drawRectButtonItemId",IMAGE_MAP_CANVAS_PANEL_ITEMID:"imageMapCanvasPanelItemId",IMAGE_MAP_PANEL_BLOCK:"cm-ime-panel"},requires:["Ext","Ext.Component","Ext.form.FieldContainer","Ext.form.Label","Ext.form.Labelable","Ext.form.field.Checkbox","Ext.form.field.Text","Ext.layout.container.Absolute","Ext.layout.container.Card",
"Ext.toolbar.Fill","Ext.toolbar.Separator","Ext.toolbar.Spacer","Ext.toolbar.Toolbar","com.coremedia.cms.editor.sdk.actions.Actions_properties","com.coremedia.cms.editor.sdk.premular.PropertyFieldPlugin","com.coremedia.cms.editor.sdk.premular.fields.SingleLinkEditor","com.coremedia.cms.editor.sdk.premular.fields.plugins.BindDisablePlugin","com.coremedia.cms.editor.sdk.validation.ShowIssuesPlugin","com.coremedia.cms.studio.im.ImageMapEditorBase","com.coremedia.cms.studio.im.ImageMap_properties","com.coremedia.icons.CoreIcons_properties",
"com.coremedia.ui.components.IconButton","com.coremedia.ui.components.Image","com.coremedia.ui.components.LocalComboBox","com.coremedia.ui.components.StatefulResizer","com.coremedia.ui.components.SwitchingContainer","com.coremedia.ui.plugins.BEMPlugin","com.coremedia.ui.plugins.BindPropertyPlugin","com.coremedia.ui.plugins.BindVisibilityPlugin","com.coremedia.ui.plugins.BlockEnterPlugin","com.coremedia.ui.plugins.ResizablePlugin","net.jangaroo.ext.Exml"],uses:["com.coremedia.cms.studio.im.ImageMapEditorConstants",
"com.coremedia.cms.studio.im.ImageMapPanel","com.coremedia.cms.studio.im.zoom.ZoomButton"]}});Ext.define("com.coremedia.cms.studio.im.ImageMapCanvasManager",function(ImageMapCanvasManager){var CANVAS_ID_PREFIX$static="kinetic-stage-";var ANCHOR_RADIUS$static=5;var ANCHOR_STROKE_WIDTH_TO_RADIUS_RATIO$static=.6;var SELECTED_OPACITY$static=.75;var UNSELECTED_OPACITY$static=.5;var RECT_SELECTOR$static=".rect";var SELECTED$static="selected";var MIN_SIZE_HOT_ZONE$static=20;function rectsMovedViaKeybordCounter_(){this.rectsMovedViaKeybordCounter$2297={}}function ImageMapCanvasManager$(image,imageWidth,
imageHeight,selectedShapeValueExpression){this.super$2297();rectsMovedViaKeybordCounter_.call(this);anchorMouseOver_.call(this);anchorMouseOut_.call(this);resizeRect_.call(this);this.image$2297=image;this.imageWidth$2297=imageWidth;this.imageHeight$2297=imageHeight;this.currentScale$2297=1;this.selectedShapeTypeValueExpression$2297=selectedShapeValueExpression;this.initCanvas$2297();this.selectedShapeTypeValueExpression$2297.addChangeListener(AS3.bind(this,"updateCursorStyle$2297"));this.updateCursorStyle$2297()}
function initCanvas(){var this$=this;var canvasId=Ext.id(null,CANVAS_ID_PREFIX$static);var canvasMarkup='\x3cdiv id\x3d"'+canvasId+'" width\x3d"'+this.imageWidth$2297+'" height\x3d"'+this.imageHeight$2297+'"/\x3e';var canvasEl=Ext.dom.Helper.insertHtml("afterEnd",this.image$2297.getEl().dom,canvasMarkup);this.image$2297.getEl().hide();this.stage$2297=new Kinetic.Stage({container:canvasEl,width:this.imageWidth$2297,height:this.imageHeight$2297});this.imageLayer$2297=new Kinetic.Layer;this.shapesLayer$2297=
new Kinetic.Layer;this.stage$2297.add(this.imageLayer$2297);this.stage$2297.add(this.shapesLayer$2297);this.stage$2297.setScale(this.currentScale$2297,this.currentScale$2297);this.canvas$2297=Ext.get(canvasEl);this.imageLayer$2297.on("mousedown",function(event){var selectedShapeType=this$.selectedShapeTypeValueExpression$2297.getValue();if(selectedShapeType&&selectedShapeType===com.coremedia.cms.studio.im.ImageMapEditor.DRAW_RECT_BUTTON_ITEM_ID)this$.addRectInitiallyByDrawing$2297(this$.getCanvasMousePositionFromEvent$2297(event))});
Ext.get(this.shapesLayer$2297.getCanvas().element).on("mousedown",function(e){var now=(new Date).getTime();if(now-this$.lastMouseDownTime$2297<this$.DBL_CLICK_PERIOD$2297)e.preventDefault();this$.lastMouseDownTime$2297=now});var imageObj=new Image;imageObj.onload=function(){var imageShape=new Kinetic.Image({x:0,y:0,image:imageObj,width:this$.imageWidth$2297,height:this$.imageHeight$2297});this$.imageLayer$2297.add(imageShape);this$.stage$2297.draw()};imageObj.src=AS3.getBindable(this.image$2297,"src",
"DUMMY");this.initShapeMovingWithKeyboard$2297()}function initShapeMovingWithKeyboard(){var this$=this;this.canvasMouseDownListener$2297=new com.coremedia.ui.util.MutableMousedownListener(this.canvas$2297.dom,function(evt){this$.handleKeyDown$2297(true);!!evt&&this$.windowMouseDownListener$2297.muteNextEvent();this$.windowMouseDownListener$2297.enable();this$.canvasMouseDownListener$2297.disable()},false);this.canvasMouseDownListener$2297.enable();this.windowMouseDownListener$2297=new com.coremedia.ui.util.MutableMousedownListener(window.document,
function(evt){this$.handleKeyDown$2297(false);this$.windowMouseDownListener$2297.disable();this$.canvasMouseDownListener$2297.enable()},true)}function handleKeyDown(handleKeys){if(handleKeys)window.addEventListener("keydown",AS3.bind(this,"keyDownListener$2297"));else window.removeEventListener("keydown",AS3.bind(this,"keyDownListener$2297"))}function keyDownListener(evt){var this$=this;var rect=AS3.as(this.selectedShape$2297,Kinetic.Rect);if(!rect)return;var newMovedViaKeyboardCount=(this.rectsMovedViaKeybordCounter$2297[rect.getId()]||
0)+1;this.rectsMovedViaKeybordCounter$2297[rect.getId()]=newMovedViaKeyboardCount;var rectGroup=this.selectedShape$2297.getParent();var inc=evt["shiftKey"]?10:1;var keyCode=evt["keyCode"];switch(keyCode){case 37:rectGroup.move(-inc,0);break;case 38:rectGroup.move(0,-inc);break;case 39:rectGroup.move(inc,0);break;case 40:rectGroup.move(0,inc)}evt.preventDefault();this.stage$2297.draw();window.setTimeout(function(){this$.fireRectMovedViaKeyboardEventLater$2297(rect,newMovedViaKeyboardCount)},500)}function fireRectMovedViaKeyboardEventLater(rect,
currentMovedViaKeyboardCount){if(currentMovedViaKeyboardCount===this.rectsMovedViaKeybordCounter$2297[rect.getId()]){delete this.rectsMovedViaKeybordCounter$2297[rect.getId()];this.handleRectMoved$2297(rect,rect.getParent())}}function updateCursorStyle(){if(this.selectedShapeTypeValueExpression$2297.getValue())this.canvas$2297.setStyle("cursor","crosshair");else this.canvas$2297.setStyle("cursor","default")}function getCanvasMousePositionFromEvent(event){var imagePosX=this.image$2297.getEl().getLeft();
var imagePosY=this.image$2297.getEl().getTop();var eventX=event.getX?event.getX():event.pageX;var eventY=event.getY?event.getY():event.pageY;var scaleFactor=1/this.getScale();var mousePosition=[Math.round((eventX-imagePosX)*scaleFactor),Math.round((eventY-imagePosY)*scaleFactor)];return mousePosition}function getStageEl(){return this.stage$2297.getContent()}function clearSelection(){if(this.selectedShape$2297){var activeShape=this.selectedShape$2297;activeShape[SELECTED$static]=false;if(AS3.is(activeShape,
Kinetic.Rect))activeShape.setOpacity(UNSELECTED_OPACITY$static);this.hideShapeAnchors$2297(activeShape);this.selectedShape$2297=null}this.fireEvent(ImageMapCanvasManager.SHAPE_SELECT,null)}function hideShapeAnchors(shape){if(shape&&shape.getParent())this.findShapeAnchors$2297(shape).forEach(function(anchor){anchor.hide()})}function showShapeAnchors(shape){var this$=this;if(shape&&shape.getParent())this.findShapeAnchors$2297(shape).forEach(function(anchor){anchor.setRadius(Math.floor(ANCHOR_RADIUS$static*
(1/this$.getScale())));anchor.show()})}function findShapeAnchors(shape){var anchors=[];var anchorNames=[];if(AS3.is(shape,Kinetic.Rect))anchorNames=anchorNames.concat([".topLeft",".topRight",".bottomRight",".bottomLeft"]);anchorNames.forEach(function(anchorName){var foundAnchors=shape.getParent().get(anchorName);foundAnchors.each(function(anchor){anchors.push(anchor)})});return anchors}function removeSelectedShape(){if(this.selectedShape$2297){var selectedShapeId=this.selectedShape$2297.getId();var group=
AS3.as(this.selectedShape$2297.getParent(),Kinetic.Group);this.clearSelection();group.removeChildren();group.remove();this.shapesLayer$2297.draw();this.fireEvent(ImageMapCanvasManager.SHAPE_REMOVE,selectedShapeId);this.fireEvent(ImageMapCanvasManager.SHAPE_SELECT,null)}}function addShapeWithOverlay(shape,anchors,group){group.add(shape);if(anchors)anchors.forEach(function(anchor){group.add(anchor)});this.stage$2297.draw()}function buildRect(x,y,width,height){var this$=this;var rect=new Kinetic.Rect({name:"rect",
x:x,y:y,width:width,height:height,fill:ImageMapCanvasManager.INVALID_FILL_COLOR,stroke:ImageMapCanvasManager.INVALID_STROKE_COLOR,strokeWidth:ImageMapCanvasManager.DEFAULT_SHAPE_STROKE_WIDTH/this.getScale(),opacity:UNSELECTED_OPACITY$static});rect[SELECTED$static]=false;rect.on("dblclick",function(){this$.doubleClickShape(rect)});rect.on("mousedown",function(event){this$.selectShape(rect)});return rect}function buildAnchor(x,y,name){if(arguments.length<=2)name="anchor";var anchor=new Kinetic.Circle({name:name,
x:x,y:y,radius:ANCHOR_RADIUS$static,stroke:"#666",fill:"#fff",strokeWidth:ImageMapCanvasManager.DEFAULT_SHAPE_STROKE_WIDTH/this.getScale(),draggable:true,visible:false});anchor.on("mouseover",this.anchorMouseOver$2297);anchor.on("mouseout",this.anchorMouseOut$2297);return anchor}function anchorMouseOver_(){this.anchorMouseOver$2297=function(){window.document.body.style.cursor="pointer";var anchor=AS3.as(this,Kinetic.Circle);if(anchor){anchor.setStrokeWidth(Math.floor(anchor.getRadius()*ANCHOR_STROKE_WIDTH_TO_RADIUS_RATIO$static));
anchor.getStage().draw()}}}function anchorMouseOut_(){this.anchorMouseOut$2297=function(){window.document.body.style.cursor="default";var anchor=AS3.as(this,Kinetic.Circle);if(anchor){anchor.setStrokeWidth(ImageMapCanvasManager.DEFAULT_SHAPE_STROKE_WIDTH/this.getScale());anchor.getStage().draw()}}}function addRectInitiallyByDrawing(startPosition){var this$=this;var initialRect=this.getInitialRect$2297(startPosition[0],startPosition[1]);function onMouseMove(event){var endPosition=this$.getCanvasMousePositionFromEvent$2297(event);
if(startPosition[0]!==endPosition[0]||startPosition[1]!==endPosition[1]){var rectUpperLeftAndLowerRightPoints=getUpperLeftAndLowerRightRectPoints$static(startPosition,endPosition);var parent=initialRect.getParent();if(!parent)return;initialRect.setPosition(rectUpperLeftAndLowerRightPoints[0][0],rectUpperLeftAndLowerRightPoints[0][1]);initialRect.setSize(Math.abs(startPosition[0]-endPosition[0]),Math.abs(startPosition[1]-endPosition[1]));this$.stage$2297.draw()}}this.canvas$2297.on("mousemove",onMouseMove,
null);this.canvas$2297.on("mouseup",function(){if(initialRect){if(initialRect.getWidth()&&initialRect.getHeight()){var coordString=""+initialRect.getX()+","+initialRect.getY()+","+ +(initialRect.getX()+initialRect.getWidth())+","+(initialRect.getY()+initialRect.getHeight());this$.fireEvent(ImageMapCanvasManager.INITIAL_SHAPE_DRAWN,com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_SHAPE_RECT,coordString)}initialRect.getParent().remove();initialRect=null}this$.canvas$2297.un("mousemove",onMouseMove,
null)},null,{single:true})}function getUpperLeftAndLowerRightRectPoints$static(point1,point2){return[[Math.min(point1[0],point2[0]),Math.min(point1[1],point2[1])],[Math.max(point1[0],point2[0]),Math.max(point1[1],point2[1])]]}function getInitialRect(xy1,xy2){var initialRect;var group=this.getNewDraggableGroup$2297();initialRect=this.buildRect$2297(xy1[0],xy1[1],Math.abs(xy1[0]-xy2[0]),Math.abs(xy1[1]-xy2[1]));initialRect.setId("_initialRect");this.addShapeWithOverlay$2297(initialRect,null,group);
this.shapesLayer$2297.add(group);this.stage$2297.draw();return initialRect}function addRect(shapeId,posX,posY,width,height){var this$=this;var group=this.getNewDraggableGroup$2297();var rectWidth=width||100;var rectHeight=height||100;var rect=this.buildRect$2297(posX,posY,rectWidth,rectHeight);rect.setId(shapeId);group.on("dragend",function(){this$.handleRectMoved$2297(rect,group)});group.on("mousedown",function(e){var now=(new Date).getTime();if(now-this$.lastMouseDownTime$2297<this$.DBL_CLICK_PERIOD$2297)e.preventDefault();
this$.lastMouseDownTime$2297=now});var anchorTopLeft=this.buildAnchor$2297(posX,posY,"topLeft");var anchorTopRight=this.buildAnchor$2297(posX+rectWidth,posY,"topRight");var anchorBottomLeft=this.buildAnchor$2297(posX,posY+rectHeight,"bottomLeft");var anchorBottomRight=this.buildAnchor$2297(posX+rectWidth,posY+rectHeight,"bottomRight");var anchors=[anchorTopLeft,anchorTopRight,anchorBottomRight,anchorBottomLeft];this.addShapeWithOverlay$2297(rect,anchors,group);anchorTopLeft.on("dragmove",this.resizeRect$2297);
anchorTopRight.on("dragmove",this.resizeRect$2297);anchorBottomLeft.on("dragmove",this.resizeRect$2297);anchorBottomRight.on("dragmove",this.resizeRect$2297);anchors.forEach(function(anchor){anchor.on("dragend",function(){var group=AS3.as(anchor.getParent(),Kinetic.Group);var rect=AS3.as(group.get(RECT_SELECTOR$static)[0],Kinetic.Rect);var shapeId=rect.getId();this$.fireEvent(ImageMapCanvasManager.SHAPE_RESIZE,shapeId,com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_SHAPE_RECT,rect)})});this.shapesLayer$2297.add(group);
this.stage$2297.draw();this.fireEvent(ImageMapCanvasManager.SHAPE_ADD,shapeId,com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_SHAPE_RECT,rect);this.selectShapeById(shapeId)}function handleRectMoved(rect,rectGroup){var stageActualWidth=Math.round(this.stage$2297.getWidth()/this.getScale());var stageActualHeight=Math.round(this.stage$2297.getHeight()/this.getScale());var currentX=Math.round(rect.getX()+rectGroup.getX());var newX=Math.round(Math.min(currentX,stageActualWidth-rect.getWidth()));
var currentY=Math.round(rect.getY()+rectGroup.getY());var newY=Math.round(Math.min(currentY,stageActualHeight-rect.getHeight()));if(newX<0)newX=0;if(newY<0)newY=0;rectGroup.move(newX-currentX,newY-currentY);this.stage$2297.draw();this.fireEvent(ImageMapCanvasManager.SHAPE_MOVE,rect.getId(),com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_SHAPE_RECT,newX,newY,rect)}function getNewDraggableGroup(){var this$=this;var group=new Kinetic.Group({draggable:true,style:"cursor: pointer"});group.on("mouseenter",
function(){this$.canvas$2297.setStyle("cursor","pointer")});group.on("mouseleave",AS3.bind(this,"updateCursorStyle$2297"));group.on("mousedown",function(event){event.stopPropagation();this$.canvasMouseDownListener$2297&&this$.canvasMouseDownListener$2297.trigger()});group.on("dragmove",function(){this$.stage$2297.draw()});return group}function resizeRect_(){this.resizeRect$2297=function(canvas){var activeAnchor=AS3.as(this,Kinetic.Circle);var group=AS3.as(activeAnchor.getParent(),Kinetic.Group);var rect=
AS3.as(group.get(RECT_SELECTOR$static)[0],Kinetic.Rect);var topLeftAnchor=AS3.as(group.get(".topLeft")[0],Kinetic.Circle);var topRightAnchor=AS3.as(group.get(".topRight")[0],Kinetic.Circle);var bottomRightAnchor=AS3.as(group.get(".bottomRight")[0],Kinetic.Circle);var bottomLeftAnchor=AS3.as(group.get(".bottomLeft")[0],Kinetic.Circle);var width;var height;var anchor;switch(activeAnchor.getName()){case "topLeft":anchor=resizeToMinLength$static(topLeftAnchor,topRightAnchor.getX(),bottomLeftAnchor.getY());
topRightAnchor.setY(anchor.anchorY);bottomLeftAnchor.setX(anchor.anchorX);break;case "topRight":anchor=resizeToMinLength$static(topRightAnchor,topLeftAnchor.getX(),bottomRightAnchor.getY());topLeftAnchor.setY(anchor.anchorY);bottomRightAnchor.setX(anchor.anchorX);break;case "bottomRight":anchor=resizeToMinLength$static(bottomRightAnchor,bottomLeftAnchor.getX(),topRightAnchor.getY());bottomLeftAnchor.setY(anchor.anchorY);topRightAnchor.setX(anchor.anchorX);break;case "bottomLeft":anchor=resizeToMinLength$static(bottomLeftAnchor,
bottomRightAnchor.getX(),topLeftAnchor.getY());bottomRightAnchor.setY(anchor.anchorY);topLeftAnchor.setX(anchor.anchorX);break}var topLeftPos=topLeftAnchor.getPosition();var newPosX=Math.round(topLeftPos.x);var newPosY=Math.round(topLeftPos.y);rect.setPosition(newPosX,newPosY);width=Math.round(topRightAnchor.getX()-topLeftAnchor.getX());height=Math.round(bottomLeftAnchor.getY()-topLeftAnchor.getY());if(width&&height)rect.setSize(width,height)}}function resizeToMinLength$static(activeAnchor,xCoord,
yCoord){var anchorCoordX=activeAnchor.getX();var anchorCoordY=activeAnchor.getY();var width=Math.round(xCoord-anchorCoordX);var height=Math.round(yCoord-anchorCoordY);if(Math.abs(width)<MIN_SIZE_HOT_ZONE$static){anchorCoordX=xCoord-calculateOffset$static(width);activeAnchor.setX(anchorCoordX)}if(Math.abs(height)<MIN_SIZE_HOT_ZONE$static){anchorCoordY=yCoord-calculateOffset$static(height);activeAnchor.setY(anchorCoordY)}return{anchorX:anchorCoordX,anchorY:anchorCoordY}}function calculateOffset$static(length){return(length<
0?-1:1)*MIN_SIZE_HOT_ZONE$static}function addArea(area){var this$=this;var coords=area[com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_COORDS].split(",");if(coords){var posX,posY;var inCanvas;if(area[com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_SHAPE]===com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_SHAPE_RECT&&coords.length>=4){posX=Number(coords[0]);posY=Number(coords[1]);var width=Number(coords[2])-posX;var height=Number(coords[3])-posY;if(width<MIN_SIZE_HOT_ZONE$static)width=
MIN_SIZE_HOT_ZONE$static;if(height<MIN_SIZE_HOT_ZONE$static)height=MIN_SIZE_HOT_ZONE$static;if(posX<this.imageWidth$2297&&posY<this.imageHeight$2297){this.addRect(area[com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_ID],posX,posY,width,height);inCanvas=true}}com.coremedia.ui.util.EventUtil.invokeLater(function(){var shapeId=area[com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_ID];if(inCanvas)if(area[com.coremedia.cms.studio.im.ImageMapEditorConstants.AREA_LINKED_CONTENT])this$.setShapeValid(shapeId);
else{this$.setShapeInvalid(shapeId);if(!this$.selectedShape$2297)this$.selectShapeById(shapeId)}else this$.fireEvent(ImageMapCanvasManager.SHAPE_REMOVE,shapeId)})}}function setShapeValid(shapeId){var shape=this.shapesLayer$2297.get("#"+shapeId)[0];if(shape&&shape.getFill()!==ImageMapCanvasManager.VALID_FILL_COLOR){shape.setFill(ImageMapCanvasManager.VALID_FILL_COLOR);shape.setStroke(ImageMapCanvasManager.VALID_STROKE_COLOR);this.shapesLayer$2297.draw()}}function setShapeInvalid(shapeId){var shape=
this.shapesLayer$2297.get("#"+shapeId)[0];if(shape&&shape.getFill()!==ImageMapCanvasManager.INVALID_FILL_COLOR){shape.setFill(ImageMapCanvasManager.INVALID_FILL_COLOR);shape.setStroke(ImageMapCanvasManager.INVALID_STROKE_COLOR);this.shapesLayer$2297.draw()}}function getShapesAtPosition(x,y){var imagePosX=this.image$2297.getEl().getLeft();var imagePosY=this.image$2297.getEl().getTop();var pos={x:x-imagePosX,y:y-imagePosY};return this.shapesLayer$2297.getIntersections(pos)||[]}function selectShapeById(shapeId){var shape=
this.shapesLayer$2297.get("#"+shapeId)[0];this.selectShape(shape)}function selectShape(shape){if(shape){this.clearSelection();this.selectedShape$2297=shape;if(AS3.is(shape,Kinetic.Rect)){shape.setOpacity(SELECTED_OPACITY$static);this.showShapeAnchors$2297(shape)}this.shapesLayer$2297.draw();this.fireEvent(ImageMapCanvasManager.SHAPE_SELECT,shape.getId())}}function doubleClickShape(shape){if(shape)this.fireEvent(ImageMapCanvasManager.SHAPE_DOUBLE_CLICK)}function getScale(){return this.currentScale$2297}
function setScale(scale){if(scale>0){this.currentScale$2297=scale;this.stage$2297.setSize(this.imageWidth$2297*scale,this.imageHeight$2297*scale);this.stage$2297.setScale(scale,scale);this.showShapeAnchors$2297(this.selectedShape$2297);this.updateStrokeWidth$2297(this.shapesLayer$2297);this.stage$2297.draw();this.image$2297.getEl().setWidth(this.imageWidth$2297*scale);this.image$2297.getEl().setHeight(this.imageHeight$2297*scale)}}function updateStrokeWidth(container){var this$=this;container.getChildren().forEach(function(node){var nodeUntyped=
node;if(node.getNodeType()==="Shape"){var shape=nodeUntyped;if(shape.getStrokeWidth()&&shape.getStrokeWidth()>0&&this$.getScale()>0)shape.setStrokeWidth(ImageMapCanvasManager.DEFAULT_SHAPE_STROKE_WIDTH/this$.getScale())}else if(node["getChildren"])this$.updateStrokeWidth$2297(nodeUntyped)})}function getId(){return this.canvas$2297.getAttribute("id")}function getRects(){var result=[];this.shapesLayer$2297.getChildren().forEach(function(group){var children=group.getChildren();if(children&&children.length>
0&&AS3.is(children[0],Kinetic.Rect))result.push(children[0])});return result}function destroy(){var params=Array.prototype.slice.call(arguments);this.stage$2297&&this.stage$2297.destroy();this.canvas$2297&&this.canvas$2297.destroy();this.selectedShapeTypeValueExpression$2297.removeChangeListener(AS3.bind(this,"updateCursorStyle$2297"));this.canvasMouseDownListener$2297.disable();this.windowMouseDownListener$2297.disable();window.removeEventListener("keydown",AS3.bind(this,"keyDownListener$2297"));
Ext.util.Observable.prototype.destroy.apply(this,params)}return{extend:"Ext.util.Observable",image$2297:null,imageHeight$2297:NaN,imageWidth$2297:NaN,canvas$2297:null,stage$2297:null,shapesLayer$2297:null,imageLayer$2297:null,selectedShape$2297:null,currentScale$2297:NaN,selectedShapeTypeValueExpression$2297:null,lastMouseDownTime$2297:0,DBL_CLICK_PERIOD$2297:200,canvasMouseDownListener$2297:null,windowMouseDownListener$2297:null,constructor:ImageMapCanvasManager$,super$2297:function(){Ext.util.Observable.prototype.constructor.apply(this,
arguments)},initCanvas$2297:initCanvas,initShapeMovingWithKeyboard$2297:initShapeMovingWithKeyboard,handleKeyDown$2297:handleKeyDown,keyDownListener$2297:keyDownListener,fireRectMovedViaKeyboardEventLater$2297:fireRectMovedViaKeyboardEventLater,updateCursorStyle$2297:updateCursorStyle,getCanvasMousePositionFromEvent$2297:getCanvasMousePositionFromEvent,getStageEl:getStageEl,clearSelection:clearSelection,hideShapeAnchors$2297:hideShapeAnchors,showShapeAnchors$2297:showShapeAnchors,findShapeAnchors$2297:findShapeAnchors,
removeSelectedShape:removeSelectedShape,addShapeWithOverlay$2297:addShapeWithOverlay,buildRect$2297:buildRect,buildAnchor$2297:buildAnchor,addRectInitiallyByDrawing$2297:addRectInitiallyByDrawing,getInitialRect$2297:getInitialRect,addRect:addRect,handleRectMoved$2297:handleRectMoved,getNewDraggableGroup$2297:getNewDraggableGroup,addArea:addArea,setShapeValid:setShapeValid,setShapeInvalid:setShapeInvalid,getShapesAtPosition:getShapesAtPosition,selectShapeById:selectShapeById,selectShape:selectShape,
doubleClickShape:doubleClickShape,getScale:getScale,setScale:setScale,updateStrokeWidth$2297:updateStrokeWidth,getId:getId,getRects:getRects,destroy:destroy,statics:{DEFAULT_SHAPE_STROKE_WIDTH:1,VALID_FILL_COLOR:"#8cb9e6",VALID_STROKE_COLOR:"#FFFFFF",INVALID_FILL_COLOR:"#FFE7F5",INVALID_STROKE_COLOR:"#CC0000",INITIAL_SHAPE_DRAWN:"initialShapeDrawn",SHAPE_ADD:"shapeadd",SHAPE_REMOVE:"shaperemove",SHAPE_MOVE:"shapemove",SHAPE_RESIZE:"shaperesize",SHAPE_SELECT:"shapeselect",SHAPE_DOUBLE_CLICK:"shapedoubleclick"},
requires:["Ext","Ext.dom.Helper","Ext.util.Observable","com.coremedia.ui.util.EventUtil","com.coremedia.ui.util.MutableMousedownListener"],uses:["com.coremedia.cms.studio.im.ImageMapEditor","com.coremedia.cms.studio.im.ImageMapEditorConstants"]}});Ext.define("com.coremedia.cms.studio.im.ImageMapPanelBase",function(ImageMapPanelBase){function ImageMapPanelBase$(config){if(arguments.length<=0)config=null;this.super$aby7(config);this.initValidationStateMixin()}return{extend:"Ext.panel.Panel",mixins:["com.coremedia.ui.mixins.ValidationStateMixin"],constructor:ImageMapPanelBase$,super$aby7:function(){Ext.panel.Panel.prototype.constructor.apply(this,arguments)},requires:["Ext.panel.Panel","com.coremedia.ui.mixins.ValidationStateMixin"]}});Ext.define("com.coremedia.cms.studio.im.ImageMapCanvasDropTarget",function(ImageMapCanvasDropTarget){function ImageMapCanvasDropTarget$(imageMapEditor,dropHandler,areaContentType){this.imageMapEditor$Fmo6=imageMapEditor;this.canvasMgr$Fmo6=imageMapEditor.getCanvasManager();this.dropHandler$Fmo6=dropHandler;this.areaContentType$Fmo6=areaContentType;this.super$Fmo6(this.canvasMgr$Fmo6.getStageEl(),AS3.cast(Ext.dd.DropTarget,{ddGroup:"ContentDD"}));this.addToGroup("ContentLinkDD")}function notifyDrop(source,
e,data){if(!this.dropHandler$Fmo6)return false;var shapes=this.canvasMgr$Fmo6.getShapesAtPosition(e.getX(),e.getY());if(!shapes||shapes.length===0)return false;var dragInfo=com.coremedia.cms.editor.sdk.dragdrop.DragInfo.makeDragInfo(data);if(!this.allowDrag$Fmo6(dragInfo))return false;this.dropHandler$Fmo6(shapes[0],dragInfo);return true}function notifyOver(source,e,data){var shapes=this.canvasMgr$Fmo6.getShapesAtPosition(e.getX(),e.getY());if(!shapes||shapes.length===0)return this.dropNotAllowed;
var dragInfo=com.coremedia.cms.editor.sdk.dragdrop.DragInfo.makeDragInfo(data);return this.allowDrag$Fmo6(dragInfo)?this.dropAllowed:this.dropNotAllowed}function allowDrag(dragInfo){if(!dragInfo)return false;var draggedItems=dragInfo.getContents();var contents=com.coremedia.cap.content.ContentProxyHelper.getContents(draggedItems);if(draggedItems.length!==contents.length)return false;if(contents.length!==1)return false;if(this.areaContentType$Fmo6){var contentType=com.coremedia.cap.common.SESSION.getConnection().getContentRepository().getContentType(this.areaContentType$Fmo6);
if(com.coremedia.cms.editor.sdk.util.LinkListUtil.containsContentNotMatchingType(contentType,contents)!==null)return false}return true}return{extend:"Ext.dd.DropTarget",canvasMgr$Fmo6:null,imageMapEditor$Fmo6:null,dropHandler$Fmo6:null,areaContentType$Fmo6:null,constructor:ImageMapCanvasDropTarget$,super$Fmo6:function(){Ext.dd.DropTarget.prototype.constructor.apply(this,arguments)},notifyDrop:notifyDrop,notifyOver:notifyOver,allowDrag$Fmo6:allowDrag,requires:["Ext.dd.DropTarget","com.coremedia.cap.common.SESSION",
"com.coremedia.cap.content.ContentProxyHelper","com.coremedia.cms.editor.sdk.dragdrop.DragInfo","com.coremedia.cms.editor.sdk.util.LinkListUtil"]}});Ext.define("com.coremedia.cms.studio.im.ImageMapEditorConstants",function(ImageMapEditorConstants){function ImageMapEditorConstants$(){}return{constructor:ImageMapEditorConstants$,statics:{AREA_ID_PREFIX:"map-area-",IMAGEMAP_STRUCT_NAME:"image-map",AREA_ID:"id",AREA_COORDS:"coords",AREA_LINKED_CONTENT:"linkedContent",AREA_SHAPE:"shape",AREA_SHAPE_RECT:"rect",AREA_ALT:"alt",AREA_ROTATION:"rotation",AREA_TARGET:"target",AREA_TARGET_BLANK:"_blank",AREA_DISPLAY_AS_INLINE_OVERLAY:"displayAsInlineOverlay",
AREA_INLINE_OVERLAY_THEME:"inlineOverlayTheme"}}});Ext.define("com.coremedia.cms.studio.im.ImageMap_properties",{"Tab_imagemap_title":"Hot Zones","ImageMap_deleteArea_text":"Remove selected area","ImageMap_openInTab_text":"Open linked content in tab","ImageMap_addRect_text":"Add rectangle area","ImageMap_fitToWidth_text":"Fit to width","ImageMap_linkedContent_fieldLabel":"Area Target","ImageMap_alt_fieldLabel":"Alternate Text","ImageMap_inline_overlay_fieldLabel":"Inline Overlay","ImageMap_inline_overlay_boxLabel":"Display Hot Zone as Inline Overlay",
"ImageMap_inline_overlay_text_color_fieldLabel":"Inline Overlay Theme","ImageMap_inline_overlay_theme_dark":"Dark","ImageMap_inline_overlay_theme_light":"Light","ImageMap_inline_overlay_theme_dark_light":"Dark on Light","ImageMap_inline_overlay_theme_light_dark":"Light on Dark","ImageMap_id_fieldLabel":"ID","ImageMap_coords_fieldLabel":"Coordinates","ImageMap_shape_fieldLabel":"Shape","ImageMap_target_fieldLabel":"Target","ImageMap_emptySelection_text":"Select an area to edit"},function(){com.coremedia.cms.studio.im.ImageMap_properties.INSTANCE=
new com.coremedia.cms.studio.im.ImageMap_properties});
//# sourceMappingURL=com.coremedia.ui.sdk__image-map-editor-components.js.map
